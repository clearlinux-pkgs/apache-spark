From d5b57d6ec34da6d5821e7fb2cf8accd3032979c6 Mon Sep 17 00:00:00 2001
From: Athenas Jimenez Gonzalez <athenas.jimenez.gonzalez@intel.com>
Date: Wed, 25 Oct 2017 15:45:44 +0000
Subject: [PATCH] Stateless-v2

---
 bin/load-spark-env.sh | 11 ++++++++++-
 bin/spark-class       |  9 +++++++++
 sbin/spark-config.sh  | 10 +++++++++-
 sbin/spark-daemon.sh  |  2 +-
 4 files changed, 29 insertions(+), 3 deletions(-)

diff --git a/bin/load-spark-env.sh b/bin/load-spark-env.sh
index 8a2f709..d211993 100644
--- a/bin/load-spark-env.sh
+++ b/bin/load-spark-env.sh
@@ -32,7 +32,16 @@ if [ -z "$SPARK_ENV_LOADED" ]; then
   # Returns the parent of the directory this script lives in.
   parent_dir="${SPARK_HOME}"
 
-  user_conf_dir="${SPARK_CONF_DIR:-"$parent_dir"/conf}"
+  # Figure out where is conf dir
+  if [[ "x${SPARK_CONF_DIR}" != "x" ]]; then
+    user_conf_dir="${SPARK_CONF_DIR}"
+  elif [[ -e "/etc/spark/spark-defaults.conf" ]]; then
+    user_conf_dir="/etc/spark"
+  else
+    user_conf_dir="/usr/share/defaults/spark/"
+  fi
+
+  echo "Config directory: $user_conf_dir" 1>&2
 
   if [ -f "${user_conf_dir}/spark-env.sh" ]; then
     # Promote all variable declarations to environment (exported) variables
diff --git a/bin/spark-class b/bin/spark-class
index 77ea40c..aaf92f6 100755
--- a/bin/spark-class
+++ b/bin/spark-class
@@ -35,6 +35,15 @@ else
   fi
 fi
 
+# Figure out where is conf dir
+if [[ "x${SPARK_CONF_DIR}" = "x" ]]; then
+  if [[ -e "/etc/spark/spark-defaults.conf" ]]; then
+    export SPARK_CONF_DIR="/etc/spark"
+  else
+    export SPARK_CONF_DIR="/usr/share/defaults/spark/"
+  fi
+fi
+
 # Find Spark jars.
 if [ -d "${SPARK_HOME}/jars" ]; then
   SPARK_JARS_DIR="${SPARK_HOME}/jars"
diff --git a/sbin/spark-config.sh b/sbin/spark-config.sh
index f2d9e6b..e625c99 100755
--- a/sbin/spark-config.sh
+++ b/sbin/spark-config.sh
@@ -24,7 +24,15 @@ if [ -z "${SPARK_HOME}" ]; then
   export SPARK_HOME="$(cd "`dirname "$0"`"/..; pwd)"
 fi
 
-export SPARK_CONF_DIR="${SPARK_CONF_DIR:-"${SPARK_HOME}/conf"}"
+# Figure out where is conf dir
+if [[ "x${SPARK_CONF_DIR}" = "x" ]]; then
+  if [[ -e "/etc/spark/spark-defaults.conf" ]]; then
+    export SPARK_CONF_DIR="/etc/spark"
+  else
+    export SPARK_CONF_DIR="/usr/share/defaults/spark/"
+  fi
+fi
+
 # Add the PySpark classes to the PYTHONPATH:
 if [ -z "${PYSPARK_PYTHONPATH_SET}" ]; then
   export PYTHONPATH="${SPARK_HOME}/python:${PYTHONPATH}"
diff --git a/sbin/spark-daemon.sh b/sbin/spark-daemon.sh
index c227c98..9e2c88f 100755
--- a/sbin/spark-daemon.sh
+++ b/sbin/spark-daemon.sh
@@ -99,7 +99,7 @@ export SPARK_PRINT_LAUNCH_COMMAND="1"
 
 # get log directory
 if [ "$SPARK_LOG_DIR" = "" ]; then
-  export SPARK_LOG_DIR="${SPARK_HOME}/logs"
+  export SPARK_LOG_DIR="/var/log/spark"
 fi
 mkdir -p "$SPARK_LOG_DIR"
 touch "$SPARK_LOG_DIR"/.spark_test > /dev/null 2>&1
-- 
2.14.3

